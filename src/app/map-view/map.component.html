<div class="MapComponent" (window:resize)="adaptSize()">
    <div *ngIf="isLoading" class="progress progress-indeterminate">
        <span class="sr-only">Caricamento...</span>
        <div class="progress-bar" role="progressbar"></div>
    </div>
    <div class="row">

        <div *ngIf="sideView=='poi' || sideView=='place' || sideView=='accessibility'
         && (selectedPoi || selectedPlace || selectedNotification)"
             class="navigation-back clickable">
            <svg class="bi pulse" width="24" height="24" fill="#D04341">
                <use
                        xlink:href="/assets/bootstrap-icons/bootstrap-icons.svg#arrow-left-short"/>
            </svg>
            <span class="back" (click)="onBackToTrailPoiClick()" *ngIf="selectedTrail">Torna al sentiero {{selectedTrail.code}}</span>
            <span class="back" (click)="onBackToTrailList()" *ngIf="!selectedTrail">Vai alla lista sentieri</span>
        </div>

        <div *ngIf="sideView=='trail'"
             class="navigation-back clickable" (click)="showTrailList()">
            <svg class="bi pulse" width="24" height="24" fill="#D04341">
                <use
                        xlink:href="/assets/bootstrap-icons/bootstrap-icons.svg#arrow-left-short"/>
            </svg>
            <span class="back">Torna alla lista sentieri</span>
        </div>

        <div class="column-map col-lg-4 col-md-4 white details functional-column" id="side-column">
            <div class="row">
                <div class="col-11 offset-1" id="trail-detail-column"
                     [class]="sideView == 'trail' || sideView == 'poi' || sideView == 'place' || sideView == 'accessibility' ? 'selection-margin' : ''">
                    <div *ngIf="sideView=='' || sideView=='list'" class="row search-section top-margin-x2">
                        <div class="col-11">
                            <app-search-input placeholder="Cerca per codice sentiero, nome o localitÃ  (e.g: 100)"
                                              (onChange)="onSearchKeyPress($event)">
                            </app-search-input>
                        </div>
                    </div>

                    <div *ngIf="sideView=='accessibility' && selectedNotification" class="row top-margin">
                        <app-notification-details
                                [selectedNotification]="selectedNotification"
                                [trailMappings]="trailMappings"
                        ></app-notification-details>
                    </div>

                    <div *ngIf="sideView=='poi' && selectedPoi" class="row top-margin">
                        <app-poi-details
                                [selectedPoi]="selectedPoi"
                                [trailMappings]="trailMappings"
                                (onSelectTrail)="onSelectTrail($event)"
                                (onHighlightTrail)="onHighlightTrail($event)"
                        ></app-poi-details>
                    </div>

                    <div *ngIf="sideView=='place' && selectedPlace" class="row top-margin">
                        <app-place-details
                                [selectedPlace]="selectedPlace"
                                [trailMappings]="trailMappings"
                                (onSelectTrail)="onSelectTrail($event)"
                                (onHighlightTrail)="onHighlightTrail($event)"
                        ></app-place-details>
                    </div>

                    <div *ngIf="sideView==''">
                        <div class="row align-middle">
                            <div class="col-md-12">
                                <p>Per iniziare, naviga la mappa, ricerca un sentiero, oppure consulta la <span
                                        class="clickable"
                                        (click)="showTrailList()">lista di sentieri del {{sectionName}}</span>
                                </p>
                            </div>
                            <div class="col-12">
                                <button class="btn btn-primary full-width" (click)="showTrailList()">Lista sentieri</button>
                            </div>
                            <div class="col-md-12 top-margin-x2">
                                <div class="row">
                                    <div class="map-icon offset-md-3 offset-sm-0"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div *ngIf="sideView=='list'" class="top-margin">
                        <app-map-trail-list
                                [trailsPreviewList]="trailPreviewList"
                                (onSelectTrail)="onSelectTrail($event)"
                        >
                        </app-map-trail-list>
                        <div class="pagination-position" *ngIf="trailPreviewList.length > 0">
                            <ngb-pagination
                                    [pageSize]="maxTrailEntriesPerPage"
                                    [collectionSize]="trailPreviewCount"
                                    [(page)]="trailPreviewPage"
                                    [size]="'sm'"
                                    [ellipses]="true"
                                    [maxSize]="2"
                                    aria-label="Default pagination"
                                    (pageChange)="loadTrailPreview($event)"
                            ></ngb-pagination>
                        </div>
                    </div>
                    <div *ngIf="sideView=='trail'" class="top-margin">
                        <app-map-trail-details
                                [selectedTrail]="selectedTrail"
                                [selectedTrailPois]="selectedTrailPois"
                                [trailNotifications]="selectedTrailNotifications"
                                [selectedTrailMaintenances]="selectedTrailMaintenances"
                                [connectedTrails]="connectedTrails"
                                [isCycloSwitchOn]="isCycloToggled"
                                [isPoiLoaded]="isPoiLoaded"
                                (onDownloadGpx)="onDownloadGpx()"
                                (onDownloadKml)="onDownloadKml()"
                                (onDownloadPdf)="onDownloadPdf()"
                                (toggleFullTrailPageEvent)="toggleFullPageTrail()"
                                (toggleNotificationListEvent)="toggleNotificationsModal()"
                                (onNavigateToLocation)="navigateToLocation($event)"
                                (onShowLocation)="onSelectPlaceByRef($event)"
                                (onSelectTrail)="onSelectTrail($event)"
                                (onNavigateToSelectedTrailCoordIndex)="navigateToSelectedTrailIndex($event)"
                                (onNavigateToTrailReportIssue)="navigateToTrailReportIssue($event)"
                                (onSelectedNotification)="onAccessibilityNotificationSelection($event)"
                                (onMaintenanceClick)="onMaintenanceClick($event)"
                                (onToggleModeClick)="onToggleMode()"
                                (onPoiClickEvent)="onPoiClick($event)"
                                (onPoiHoveringEvent)="onPoiHovering($event)"
                                (onShowTrailClassificationCycloInfo)="onShowCyclingClassification()"
                                (onShowTrailClassificationHikingInfo)="onShowHikingClassification()"
                                (onHighlightTrail)="onHighlightTrail($event)"
                        >
                        </app-map-trail-details>
                    </div>
                </div>
            </div>

        </div>

        <!--  Map Column  -->
        <div class="column-map col-lg-8 col-md-8">
            <app-map-full id="map-full-container"
                          [selectedTrail]="selectedTrail"
                          [selectedTrailNotification]="selectedTrailNotifications"
                          [selectedTrailIndex]="selectedTrailIndex"
                          [tileLayerName]="selectedTileLayer"
                          [trailList]="trailList"
                          [pois]="selectedTrailPois"
                          [startingZoomLevel]="zoomLevel"
                          [userPosition]="userPosition"
                          [showTrailCodeMarkers]="showTrailCodeMarkers"
                          [poiHovering]="poiHovering"
                          [trailHovering]="highlightedTrail"
                          [highlightedLocation]="highlightedLocation"
                          (onViewChange)="geoLocateTrails($event)"
                          (onTrailClick)="onSelectTrail($event)"
                          (onNotificationClick)="onAccessibilityNotificationSelection($event)"
                          (onZoomChange)="onZoomChange($event)"
                          (onLoading)="onLoading()"
                          (onDoneLoading)="onDoneLoading()"
                          (onPoiClick)="onPoiClick($event)"
                          (onLocationSelection)="onSelectPlaceByRef($event)"
            >
            </app-map-full>
        </div>
    </div>
</div>